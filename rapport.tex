\documentclass[a4paper, 11pt]{report}

\usepackage[utf8]{inputenc}
\usepackage[french]{babel}
\usepackage{eurosym}
\usepackage{graphicx}
\usepackage{titlesec}
\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}

\newcommand{\sectionbreak}{\clearpage}
\newcommand{\pir}[0]{\textbf{$\pi r^2$}\xspace}
\newcommand{\coq}[0]{\textbf{Coq}\xspace}
\newcommand{\coqdoc}[0]{\textbf{Coqdoc}\xspace}
\newcommand{\yrg}[0]{\xspace\textbf{Yann Régis-Gianas}\xspace}
\newcommand{\epita}[0]{EPITA}
\newcommand{\lc}[0]{$\lambda$-calcul\xspace}

\lstset{language=Caml, frame=single, language=Caml,
commentstyle=\color{dkgreen}, basicstyle=\ttfamily\footnotesize}
\lstset{literate=%
  {é}{{\'e}}1
  {è}{{\`e}}1
  {â}{{\^a}}1
}

\title{Rapport de stage de fin de tronc Commun: \\
  Réécriture de Coqdoc}
\author{François Ripault}
\date{FIXME}

\begin{document}
\maketitle
\thispagestyle{empty}

\tableofcontents
\thispagestyle{empty}

\setcounter{page}{0}
\chapter{Introduction}
  %% 3 -> 5 pages
  Le présent rapport détaille travaux effectués au cours du stage de fin
  de tronc commun à l'\epita, réalisé du 3 Septembre 2012 au 11 Janvier 2013.

  Le sujet du stage consiste en la refonte complète du logiciel de
  documentation \coqdoc.

  \section{Contexte du stage}
  Ce stage s'est déroulé au sein de l'INRIA, plus particulièrement dans
  l'équipe \pir.

  L'INRIA est l'institut national de recherche en informatique et en
  automatique. C'est un établissement public à caractère scientifique et
  technologique, qui est l'acteur principal de la recherche en informatique en
  France.

  Je fut intégré à l'équipe \pir appartenant au laboratoire Preuves, Programmes et
  Systèmes.

  Le laboratoire \textbf{Preuve, programmes et systèmes} est une unité mixte
  de recherche, rattachée à plusieurs établissements scientifiques (INRIA,
  CNRS, et l'université Paris Diderot), qui regroupe à la fois des
  chercheurs en informatique et en logique mathématique, au sein d'une même
  thématique, celle des langages de programmation, des systèmes distribués,
  et de leurs fondements logiques.

  Au sein de ce laboratoire, l'équipe \pir se concentre sur la recherche
  autour de la correspondance entre preuves et programmes, ayant donné
  naissance à l'assistant de preuves \coq, et le formalisme qui sous-tend
  l'implémentation d'un tel logiciel.

  Ce stage fut effectué sous la direction de \yrg, maître de conférence à
  l'université Paris Diderot.
  %% FIXME

  \section{Problématique du stage}
  L'objectif de ce stage est de refaire le logiciel de documentation de
  l'assistant de preuves \coq, ne répondant plus aux attentes de ses
  utilisateurs.
  En effet, bien que celui-ci remplisse correctement sa tache il souffre d'un
  manque crucial d'extensibilité et s'intègre mal dans la suite d'outils
  fournie avec \coq. Il s'agit donc de refaire entièrement \coqdoc{} afin de
  mieux l'intégrer dans \coq, tout en concevant une architecture qui permette
  de l'étendre facilement par la suite.

  \section{Motivations et perspectives}
  Le stage offre des perspectives très intéressantes en relation directe
  avec mes objectifs professionnels, tout en mettant en application les
  compétences que j'ai acquises au cours de cycle de tronc commun.
  %%% FIXME

  \subsection{Validation des acquis de tronc commun}
  Le projet proposé met en jeu des compétences propres au métier d'ingénieur.
  En effet, la conception d'un nouveau logiciel est en relation directe
  avec les enseignements de l'\epita:
  \begin{itemize}
    \item \textbf{Conception d'un logiciel:} le stage a pour but la réécriture à
      neuf d'un logiciel préexistant: \coqdoc. L'objectif est de créer un outil
      s'intégrant bien dans la suite \coq, palliant aux problèmes de l'outil
      précédent, mais également en réutilisant les éléments intéressants pour
      la nouvelle version de \coqdoc.

      La conception d'un nouveau logiciel permet de mettre en application
      les compétences de programmation mais également des aspects
      annexes concernant le développement de projet, telle que
      la documentation du code ou la réalisation de tests unitaires.
    \item \textbf{Gestion de projet:} Écrire un nouveau logiciel
      apporte également des problématiques concernant la gestion de
      ce projet: il faut choisir un cycle de développement
      approprié permettant dans le temps du stage, de réaliser
      l'application. Il s'agit également de répondre aux attentes
      des utilisateurs concernant le projet, et de faciliter l'intégration
      du logiciel au sein de la suite d'outils \coq.
  \end{itemize}

  \subsection{Introduction au monde de la recherche}
  Ce stage représente également une bonne introduction aux problématiques
  de recherche abordées dans le domaine de l'équipe \pir.

  En effet, bien que le sujet de stage mette en jeu des compétences surtout
  liées au domaine de l'ingénierie, le contexte scientifique du stage me
  permet de découvrir les problématiques de recherche dans le laboratoire PPS
  et plus particulièrement l'équipe de recherche \pir.

  Cela répond directement à mes objectifs professionnels puisque après l'\epita,
  j'ai l'intention de poursuivre dans le monde de la recherche. Ce stage me
  permet donc de valider cet objectif professionnel, tout en tissant des liens
  avec les scientifiques travaillant dans ce domaine.

  %%FIXME: parler du CV ?
  \section{Phases de déroulement et introduction du rapport}
  Ce rapport retrace les différentes phases de déroulement du stage :
  \begin{itemize}
    \item la prise de connaissance des problématiques à résoudre
    \item la conception du logiciel de documentation
    \item l'implémentation de ce logiciel
  \end{itemize}

  Une première partie présentes les différentes structures au sein desquelles
  s'est effectué mon stage, ainsi que l'intégration des réalisation de ce stage
  dans les travaux de l'entreprise. \\
  Dans une deuxième partie, analysons l'existant et définissons la méthodologie
  et les objectifs du stage. \\
  La troisième partie détaillera la phase de réalisation technique.
  Enfin, dans une dernière partie, nous offrons une analyse critique des
  résultats de ce stage.

\chapter{Présentation de l'entreprise}
%% 5 -> 10
  Le stage proposé s'est fait au sein de l'équipe \pir, appartenant au
  laboratoire PPS, regroupant des chercheurs de plusieurs instituts de
  recherche. Cette section présente l'institut de recherche qui m'a employé
  ainsi que le laboratoire PPS, pour enfin présenter l'équipe \pir.
  \section{Le secteur d'activité}
  L'INRIA est un acteur majeur de la recherche informatique, aussi bien en
  France qu'à l'international.

  Les activités de recherche de l'INRIA sont regroupées en 5 thèmes qui visent
  à décrire une \textbf{activité scientifique} très large :
  \begin{itemize}
    \item Mathématiques appliquées, calcul et simulation
    \item Algorithmique, programmation, logiciels et architectures
    \item Réseaux, systèmes et services, calcul distribué
    \item Perception, cognition, interaction
    \item STIC pour les sciences de la vie et de l'environnement
  \end{itemize}

  % \subsection{Collaborations avec l'industrie}
  L'INRIA travaille avec de nombreux \textbf{partenaires industriels}.
  Les principaux partenaires sont les suivants :
  \begin{itemize}
    \item Alcatel-Lucent
    \item EDF R\&D
    \item STMicroelectronics
    \item Bull
    \item Andra
    \item Microsoft-research \\
  \end{itemize}

  L'institut ne se contente pas uniquement de collaborations avec l'industrie,
  c'est également un créateur \textbf{Start-up}, qui commercialisent des
  produits issus des prototypes de recherche, et du savoir-faire de l'INRIA

  L'INRIA possède également de nombreux \textbf{partenariats à
  l'international}, tant avec des universités mondialement reconnues qu'avec
  des sociétés multinationales.

  \section{L'entreprise}
    \subsection{Présentation générale}
    La fondation d'INRIA remonte à 1967 sous le nom de IRIA (Institut de
    recherche en informatique et en automatique). L'IRIA est devenu l'Institut
    national de recherche en informatique et en automatique (INRIA) en 1979.
    L'INRIA est placé sous la double tutelle du ministère de la recherche et
    du ministère de l'économie, des finances et de l'industrie. \\
    INRIA est signataire du Pacte PME depuis le 17 décembre 2008, et l'institut
    participe à l'espace européen de la recherche à travers le consortium
    ERCIM, dont il a été l'un des membres fondateurs en 1989.

    L’INRIA a pour vocation d’entreprendre des recherches fondamentales et
    appliquées dans les domaines des sciences et des technologies de l’information
    et de la communication (STIC). L’institut assure également un fort
    transfert technologique en accordant une grande attention à la formation
    par la recherche, à la diffusion de l’information scientifique et
    technique, à la valorisation, à l’expertise et à la participation à des
    programmes internationaux. Jouant un rôle fédérateur au sein de la
    communauté scientifique de son domaine et au contact des acteurs
    industriels, l’INRIA est un acteur majeur dans le développement des STIC en
    France.

    L’INRIA est actif au sein d’instances de normalisation comme l’IETF,
    l’ISO ou le W3C dont il a été le pilote européen de 1995 à fin 2002.
    Enfin l’institut entretient d’importantes relations internationales : en
    Europe, l’INRIA s’implique fortement dans le 6ème PCRDT où il participe
    à plus de 40 actions ainsi que dans le consortium ERCIM, qui regroupe 17
    organismes de recherche. A l’international, l’institut collabore avec de
    nombreuses institutions scientifiques via plusieurs laboratoires de
    recherche conjoints (LIAMA, PPS), les « équipes de recherche associées »,
    et différents programmes de coopération.

    \subsection{Les missions de l'INRIA}
    Les grandes missions de l'INRIA se résument dans les points suivants:
    \begin{itemize}
     \item Concevoir et maîtriser les futures infrastructures des réseaux et
     des services de communication
     \item Développer le traitement des informations et données multimédia
     \item Garantir la fiabilité et la sécurité des systèmes à logiciel
     prépondérant
     \item Coupler modèles et données pour simuler et contrôler les systèmes
     complexes
     \item Combiner simulation, visualisation et interaction
     \item Modéliser le vivant
     \item Intégrer pleinement les STIC dans les technologies médicales
    \end{itemize}
    \subsection{Organisation}
    L'organisation de l'INRIA est établie par le décret du 2 août 1985.
    L'institut est dirigé par un conseil d'administration, dont son
    président, assure également les fonctions de directeur général.
    Il peut s'appuyer sur les compétences de deux instances scientifiques :
    \begin{itemize}
      \item \textbf{le conseil scientifique}, instance de réflexion et de
      proposition de l'institut en matière de politique scientifique,
      \item \textbf{la commission d’évaluation}, instance chargée de procéder à
      l'évaluation des équipes de recherche et des personnels scientifiques
      et qui contribue à définir les orientations des activités de l'institut.
    \end{itemize}

    Le conseil d'administration regroupe :
    \begin{itemize}
      \item \textbf{Un membre de droit} : le directeur général du Centre national de
        la recherche scientifique ou son représentant.
      \item \textbf{7 représentants de l'état désignés} respectivement par les
        ministres chargés de la recherche, de l'industrie, du budget, de
        l'enseignement supérieur, de la défense, des relations extérieures et
        des télécommunications.
      \item \textbf{8 personnalités} : deux personnalités de l'industrie de
        l'informatique et de l'automatique, deux personnalités scientifiques,
        deux personnalités représentatives du monde du travail, deux
        personnalités choisies parmi les utilisateurs de l'informatique et de
        l'automatique désignées par le ministre chargé de l'industrie.
      \item \textbf{4 représentants du personnel} de l'institut ou leurs
        suppléants dont deux chercheurs, élus pour une durée de quatre ans
        renouvelable une fois, selon des modalités fixées par arrêté du
        ministre chargé de la recherche et du ministre chargé de l'industrie.
    \end{itemize}

    L'INRIA est structuré en 6 unités de recherche à travers la France :
    Rocquencourt et son antenne Parisienne, Rennes, Sophia Antipolis, Grenoble,
    Nancy, Bordeau, Lille, Saclay, Marseille, Lyon et Metz. \\

    En tout, ces sites regroupent (données de février 2011):
    \begin{itemize}
      \item 4200 personnes, dont 2500 rémunérées par l'INRIA
      \item 3150 scientifiques: 1200 doctorants, 250 post-doctorants et 600
        ingénieurs R\&D
      \item 300 stagiaires
    \end{itemize}
    Au sein de ces scientifiques, on compte notamment :
    \begin{itemize}
      \item 6 membres de \textbf{l'académie de sciences}
      \item 16 lauréats du \textbf{conseil européen de la recherche}
    \end{itemize}

    Les chiffres clefs de la recherche scientifique à l'INRIA :
    \begin{itemize}
      \item 200 équipes projets
      \item 67 équipes associées, de dimension internationale
      \item 4500 publications scientifiques
      \item 24 conférences internationales
      \item 105 projets européens dans lesquels s'implique l'INRIA
    \end{itemize}

    Les chiffres pour les partenariats avec l'industrie :
    \begin{itemize}
      \item 230 brevets en activité
      \item 100 entreprises crées par l'institut
    \end{itemize}

    L'INRIA bénéficie d'un budget de 231 M\euro{} dont 125,8 M\euro{} alloués à la
    recherche (54\% du budget) (chiffres pour l'année 2011). La prévision
    de recette pour l'année 2011 étant de 227,6M\euro{}, cela en fait un institut
    de recherche presque autosuffisant.

    L'organigramme \ref{orga} présente les différents services de l'INRIA ainsi
    que leur directeurs respectifs
    \begin{figure}
    \includegraphics[scale=0.85]{data/organigrammeinria.pdf}
    \caption{Organigramme des différents services de l'INRIA}
    \label{orga}
    \end{figure}

    %% structure logique
    %% datas sur le pognon et les employés
  \section{Le service}
  Cette section présente le laboratoire PPS. Ce n'est pas à proprement parler
  un service de l'INRIA, car c'est un groupe de recherche multidisciplinaire
  regroupant des chercheurs de tous horizons, et de toutes structures de
  recherche.
    \subsection{Le laboratoire Preuves, Programmes  et Systèmes}
    PPS est un laboratoire qui regroupe les chercheurs venant de l'informatique
    et de la logique mathématique autour de l'idée que la logique et d'autres
    champs des mathématiques peuvent permettre d'élucider le sens de programmes,
    d'améliorer leur sûreté et réciproquement, que l'informatique est une source
    permettant aux mathématiques d'avancer.

    La majorité de la recherche menée par PPS gravite autour la correspondance
    de Curry-Howard: l'équivalence entre preuve et programmes, transformant
    le \lc\footnote{Le \lc{} est un formalisme mathématique
    qui constitue les fondements des langages de programmations du paradigme fonctionnels} en un
    outil utilisé pour établir des preuves mathématiques. Réciproquement, le
    savoir de la logique mathématique devient un élément de réponse pour les
    problèmes posés par l'industrie.

    \subsection{Thématiques de recherche du laboratoire}
      Les thématiques du laboratoire peuvent être regroupées en six directions
      principales :
      \begin{itemize}
        \item \textbf{Jeux et modèles de la programmation} : \\
          Les modèles de jeux permettent de modéliser mathématiquement
          l'interaction d'un programme avec son environnement. Ce champ de
          recherche débouche aujourd'hui sur des outils d'analyse et de
          certification des programmes
        \item \textbf{Théorie de la démonstration et \lc} :
          Ce domaine d'étude se concentre sur le développement de l'assistant
          de preuve Coq et les champs de recherche qui lui sont associés,
          tels que le calcul des constructions inductives.
        \item \textbf{Spécifications et réalisabilité} :
          L'objectif est, à partir d'un théorème mathématique, de trouver
          le programme équivalent. L'approche particulière de ce domaine est
          qu'au lieu de supposer une formule avant la preuve, la théorie de la
          réalisabilité considère les formules comme faisant partie des
          spécifications d'un programme.
        \item \textbf{Réécriture} :
          La théorie de la réécriture combine des éléments de la logique, de
          l'algèbre, du \lc, etc $\ldots$, et a pour but de transformer des
          programmes (et plus précisément des objets syntaxiques) à travers
          l'application de règle bien déterminées. Cette théorie propose
          un formalisme permettant de modéliser à la fois des langages
          fonctionnels, impératifs ou encore orientés objet.
          Les applications d'une telle théorie sont très diverses: la plus
          connue étant probablement l'optimisation d'un programme par le
          compilateur par le moyen de la réécriture de code.
          La théorie de la réécriture permet de formaliser et de prouver ces
          mécanismes.
        \item \textbf{Programmation} : \\
          Le laboratoire développe de nouvelles méthodes de programmations
          appliquées à de nombreux domaines qui vont des protocoles réseaux
          jusqu'au web. Ces développements sont étroitement liés à la
          logique mathématique, et permettent de mettre en évidence des
          propriétés sur ces programmes\footnote{Par exemple, le framework de
          développement web Ocsigen, donne la garantie de générer des pages
          web valides selon les standards W3C}.
        \item \textbf{Logique, Concurrence et Modélisation} : \\
          Un nouveau front de recherche s'est récemment ouvert à PPS, autour
          de la modélisation de la programmation dite concurrente (calculs de
          processus) et mobile, qu'il s'agisse d'en rechercher les fondements
          logiques, ou de les appliquer à une troisième science : la
          biologie, et plus précisément à la modélisation des processus de
          la biologie moléculaire.
      \end{itemize}

      \subsection{L'équipe \pir}
      L'équipe \pir{} est composée de chercheur faisant partie du laboratoire
      PPS, mais également de scientifique appartenant à l'université
      Paris-Diderot, et l'INRIA.

      Ses sujets de recherche sont les suivants :
      \begin{itemize}
        \item La recherche fondamentale autour de la correspondance entre preuve et programmes
        \item La recherche théorique autour du formalisme qui sous-tend les
          mécanismes de l'assistant de preuves Coq
        \item Un domaine d'implémentation: Coq, notamment en le considérant comme
          un langage de programmation avec des types-dépendants.
      \end{itemize}
      L'équipe développe notamment deux logiciels, Coq (présenté ci-après),
      et Pangolin, qui lui permet la certification de programmes fonctionnels.
      \subsubsection{L'assistant de preuves Coq}
      Le logiciel Coq est un outil de développement semi-interactif de
      preuves bâti autour d'un langage de programmation fonctionnelle
      fortement typé. Développé conjointement par plusieurs équipes INRIA et
      hors INRIA, Coq est utilisé tant pour la formalisation des
      mathématiques que pour la certification de propriétés de programmes.
      Naturellement doté de types dépendants, Coq a une carte à jouer comme
      langage de programmation à type riches. Un des objectifs de \pir dans
      ce cadre est le développement de bibliothèques de programmation
      certifiée, la certification du processus d'extraction de programme Coq
      vers des langages fonctionnels comme Objective Caml, ainsi que le
      développement de nouvelles méthodes de preuves pour Coq.

      Les principaux champs d'applications de Coq sont les suivants :
      \begin{itemize}
        \item L'écriture de compilateurs certifiés : le projet Compcert en
          est un bon exemple: c'est un compilateur C pour lequel la traduction
          du C en code machine est mathématiquement prouvée.
        \item La validation de preuves mathématiques : les publications
          scientifiques dans le domaine des mathématiques incluent parfois
          des preuves de plusieurs centaines de pages. Coq est un outil
          permettant de valider les preuves ainsi publiées. On peut citer
          le théorème de Fermat-Wiles ou encore Feit-Thompson comme exemples
          de cette application.
        \item Dans la recherche fondamentale en Informatique: c'est un outil
          qui permet de formaliser (et valider) la sémantique des langages de
          programmation et, qui est utilisé plus largement dans la théorie
          des langages de programmation.
      \end{itemize}

      \section{Le positionnement du stage dans les travaux de l'entreprise}
      L'utilisation d'un logiciel de documentation est très importante lors du
      développement d'un projet.
      Au sein du développement de Coq, Coqdoc possède plusieurs cas
      d'utilisation qui en font un outil très utilisé, et dont l'amélioration
      est supposée offrir plusieurs avantage. La liste suivante
      présente les différents cas d'utilisations de Coqdoc dans le projet :
      \begin{itemize}
        \item \textbf{Documentation de développement du compilateur :} \\
          Bien qu'une importante partie de Coq soit écrit en Caml, l'ensemble
          des bibliothèques standards, c'est à dire les outils pour Coq
          fournis avec le compilateur, sont écrites en Coq. Coqdoc permet donc
          de décrire le fonctionnement d'une importante partie du code source
          du compilateur.
        \item \textbf{Documentation utilisateur :} \\
          Une importante partie de la documentation explique le fonctionnement
          du projet Coq à l'utilisateur. Dans une documentation utilisateur,
          le code sert d'exemple aux explication fournies par la documentation.
        \item \textbf{Écriture de documents :} \\
          Cette application se distingue de l'écriture de documentation car
          elle n'est pas directement associée à un code source. L'objectif ici
          est d'inclure les avantages de Coqdoc (coloration syntaxique,
          mise en forme du code) dans des documents qui ne sont pas directement
          liés au compilateur, tels que des articles scientifiques ou des
          livres.
      \end{itemize}

      Coqdoc possède donc une grande importance au sein du projet Coq. La
      reconception de ce logiciel doit permettre d'offrir des fonctionnalités
      qui impacteront l'ensemble de ses utilisateurs.

\chapter{Travail effectué}
Cette section détaille le travail effectué au cours de ce stage de fin de tronc
commun. Nous détaillons tout d'abord les objectifs à atteindre en présentant
les outils utilisés, et en expliquant les spécificités propre à ce stage.
Nous expliquons ensuite les différentes phases de la conception du logiciel,
y compris le développement. Enfin, nos offrons une analyse critique des
résultats que nous avons obtenus à l'issue de ce stage de fin de tronc commun.
%% 40 -> 50
  \section{Le cahier des charges}
  Cette section détaille les objectifs du stage à travers une analyse des outils
  existants (plus précisément, "l'ancien" Coqdoc, et Coq-tex), un état de
  l'art sur ce genre d'outils, et nous détaillons les objectif à atteindre pour
  le nouveau Coqdoc.
    \subsection{Logiciels de documentation}
    Lors du développement d'un logiciel, le code source est souvent insuffisant
    pour détailler le fonctionnement du programme, car il manque en clarté et
    n'est pas toujours assez explicite.
    Le rôle de la documentation est de décrire les différents aspects du
    fonctionnement attendu du code source. Cette documentation est incluse
    dans les fichiers sources sous forme de commentaires, de façon à ce
    qu'elle soit facilement accessible aux développeurs.

    Le rôle d'un logiciel de documentation est d'extraire ces informations
    contenues dans le code source afin d'en constituer un guide de référence
    ou un manuel, sous forme de pages web ou de documents PDF.
    Cela permet au programmeur de bénéficier d'un document décrivant clairement
    le projet, et de détailler les fonctionnalités accessibles au programmeur.

    L'utilisation d'un générateur de documentation possède plusieurs intérêts :
    \begin{itemize}
      \item \textbf{Facilité de mise à jour de la documentation :} \\
        Parce que la documentation est située dans le code source, lorsqu'un
        développeur modifie un fichier, il peut facilement mettre à jour cette
        documentation. Ainsi, le manuel de référence associé au code source
        évolue en même temps que celui-ci.
      \item \textbf{Mise en forme automatique de documents :} \\
        Les logiciels de documentation possèdent des règles de mise en forme
        des commentaires dans les documents produits. Ainsi, un générateur
        de documentation sait traiter les informations de mise en forme
        données par le programmeur, pour avoir une meilleure explication du
        code source (découpages logiques, titres, mettre en gras les éléments
        importants dans les commentaires).
      \item \textbf{Variété des formats de sortie :} \\
        Enfin, l'un des éléments les plus important est le fait qu'un logiciel
        de documentation sait gérer plusieurs formats de sorties pour la
        documentation, allant de la génération de pages web à la génération de
        PDF.
    \end{itemize}

    L'exemple \ref{fig1} présente un morceau de code documenté, et le rendu
    généré par coqdoc.

    \begin{figure}
      \lstinputlisting
        {data/source1.v}
      \fbox{
      \includegraphics[trim=0mm 0mm 2cm 0cm,clip=true, width=\textwidth]{data/rendu1.png}}
      \caption{Exemple de rendu généré par coqdoc}
      \label{fig1}
    \end{figure}

    \clearpage

    \subsection{Analyse de l'existant : Coqdoc}
    Le projet Coq avait déjà un logiciel de documentation de son code source.
    Cette section détaille les particularités de ce logiciel. L'un des objectifs
    du stage était d'avoir un nouveau Coqdoc dont le comportement est le plus
    proche possible de l'ancien : il doit pouvoir gérer les mêmes options et
    un rendu similaire. Cela permet de :
    \begin{itemize}
      \item Faciliter l'intégration du nouveau logiciel grâce à la
        rétro-compatibilité
      \item Avoir un rendu similaire par rapport aux pages de documentations
        générées auparavant
      \item Se servir de l'ancien logiciel comme référence pour un ensemble
        de tests fonctionnels et techniques
    \end{itemize}

    \subsubsection{Format des fichiers d'entrée}
    Comme beaucoup de logiciels de documentation, Coqdoc propose un langage de
    mise en forme de la documentation : ce sont des balises, qui, en étant
    présentes dans le code source, permettent de mettre en forme le fichier de sortie,
    et qui permettent de donner de plus amples informations à propos du code
    documenté.
    \begin{itemize}
      \item[] \textbf{Format des lignes de documentation :} \\
      Comme nous l'avons déjà vu, Coqdoc fait une distinction entre commentaires
      et documentation. En Coq, les commentaires sont préfixés par "(*" et se
      terminent par "*)". Coqdoc considère que tout commentaire commençant par
      "(**" est une portion de texte devant apparaître dans la documentation
      générée.
      \item[] \textbf{Titres :} \\
      Pour introduire des titres dans le document de sortie, l'utilisateur
      peut préfixer le début d'une ligne par 1 à 4 astérisques suivies d'une
      espace. Le nombre d'astérisques déterminant le niveau d'importance du
      titre.
      \item[] \textbf{Listes :} \\
        Tout ligne commençant par un tiret et précédée de \texttt{n} espaces
        est un élément d'une liste, dont le niveau de profondeur est déterminé
        par le nombre d'espaces
      \item[] \textbf{Séparateur horizontal :} \\
        Une ligne constituée uniquement de 4 tirets ou plus produit un
        séparateur horizontal
      \item[] \textbf{Emphase :} \\
        Il est possible de mettre en valeur des mots en les encadrant
        de tirets bas ("\texttt{\_}").
      \item[] \textbf{Verbatim :} \\
        On peut inclure du code dans de la documentation en encadrant cette
        portion de code de double chevrons (\texttt{<<} et \texttt{>>})
      \item[] \textbf{Cacher des portions de code :} \\
        A des fins de clarté dans la documentation, on peut cacher
        (ou afficher) des portions de code avec les délimitant avec
        \texttt{(* begin hide *)} et \texttt{(* end hide *)}
        (pour forcer l'affichage, il suffit de remplacer \texttt{hide} par \texttt{show})
      \item[] \textbf{Règles de traduction :} \\
        L'utilisateur peut définir des règles de traduction avec le mot clef
        printing, avec les délimiteurs suivants
        \begin{itemize}
          \item \texttt{\#} pour une sortie HTML
          \item \texttt{\%} pour une sortie en LaTeX
          \item \texttt{\$} pour une notation mathématique en sortie LaTeX
        \end{itemize}
    \end{itemize}
    La figure \ref{source2} donne un exemple de ces règles de mise en forme
    dans le fichier d'entrée
    \begin{figure}
      \lstinputlisting{data/source2.v}
      \caption{Exemple des règles de mise en forme de Coqdoc}
      \label{source2}
    \end{figure}

    \subsubsection{Format des fichiers de sortie :}
    Le rôle de Coqdoc est d'effectuer une traduction du format d'entrée
    précédemment présenté vers plusieurs formats de sortie. Au cours
    de cette traduction, Coqdoc prends en compte les règles de mise en forme
    données en entrée pour la documentation et fait une analyse syntaxique du
    code source.

    La liste suivante détaille les différentes caractéristiques de Coqdoc dans
    la génération des fichiers de sortie

    \begin{itemize}
      \item \textbf{Mise en forme de la documentation} \\
        La première étape est la traduction des informations de mise en forme
        contenues dans la documentation. Le rôle de Coqdoc ici est de générer
        les balises adéquates dans le format de
      \item \textbf{Analyse syntaxique du code source} \\
        Coqdoc a également pour rôle de mettre en forme le code source des
        fichiers lus en entrée. Pour cela il effectue une analyse syntaxique
        des sections de code source, et met en forme ces éléments de code
        source dans le fichier de sortie, en effectuant :
        \begin{enumerate}
          \item Une coloration syntaxique du code
          \item Le \textit{pretty print} de certains symboles selon les règles
            de traduction par défaut, et également selon celles définies
            par l'utilisateur. Par exemple, l'ancien coqdoc traduit
            automatiquement le symbole \texttt{->} en \texttt{$\rightarrow$}.
            Le tableau \ref{trad:coqdoc} donne une liste exhaustive des
            symboles traduits par coqdoc.
        \end{enumerate}
      \item \textbf{Gestion de la structure logique de la documentation} \\
        Coqdoc doit également gérer les règles de génération des fichiers selon
        la volonté de l'utilisateur. Ceci est fait avec des options passées à
        Coqdoc, qui permettent de définir si un seul fichier doit être généré
        (pour un manuel de référence par exemple) ou plusieurs
        (pour une documentation utilisateur). Il y a également des règles par
        défaut selon le format de fichier de sortie : par exemple, pour une
        sortie HTML, plusieurs fichiers seront générés, tandis qu'une sortie
        en LaTeX entraînera la génération d'un seul fichier mettant en commun
        tous les fichiers d'entrée.
      \item \textbf{Génération des liens hypertextes} \\
        Une autre partie du travail de Coq est la génération des liens
        hypertextes, qui permettent de faire référence à :
        \begin{enumerate}
          \item Des \textbf{identifiants déclarés dans d'autres fichiers} : en
            effet,
            l'utilisateur fournit souvent plusieurs fichiers à documenter, et
            un identifiant peut avoir une importance dans plusieurs fichiers.
            Cette génération de liens permet de faciliter la lecture de la
            documentation, en proposant un lien vers la déclaration de
            l'identifiant, pour permettre à l'utilisateur d'obtenir de plus
            amples informations à propos de celui-ci si nécessaire.
            Cette génération de liens se base sur des fichiers issus de la
            compilation ayant pour extension \texttt{.glob} qui détaille les
            identifiants déclarés dans un fichier. Grâce à ceux ci, Coqdoc peut
            ainsi générer des références entre plusieurs fichiers.
          \item Coqdoc propose également de générer des \textbf{références à
            la documentation de la bibliothèque standard}; cela permet de
            fournir à l'utilisateur un moyen rapide de s'informer sur un
            élément faisant partie du langage Coq.
          \item De la même manière, il est possible de faire \textbf{référence
            à une bibliothèque externe}, pour pouvoir détailler de celle-ci
            avec le projet documenté.
        \end{enumerate}
    \end{itemize}

    \subsection{Analyse de l'existant : Coq-tex}
    Un des autres objectifs de ce stage était d'offrir un remplacement pour
    Coq-tex, un des autres outils du projet Coq. Nous détaillons dans une
    première partie l'approche qu'offre Coq-tex à propos de la programmation,
    pour ensuite détailler son fonctionnement.

    \subsubsection{Programmation lettrée}
    La programmation lettrée (\textit{literate programming}) est une approche
    de la programmation introduite par \textbf{Donald Knuth} dans laquelle
    le code source du programme suit le flux de pensée de l'auteur : à la
    manière d'un article, le programmeur introduit les concepts de son
    programme dans l'ordre logique de la pensée humaine, au lieu de suivre
    l'ordre logique et la manière demandée par le compilateur. A travers un
    ensemble de fonctions (ou plutôt de macros), l'auteur peut cacher
    l'abstraction demandée par l'ordinateur pour s'exprimer dans un langage
    plus proche du langage naturel.

    Ainsi les outils pour la programmation lettrée permettent de générer deux
    versions d'un code source : une nouvelle version du code adaptée à la
    génération d'un \textbf{programme} par un compilateur, et une autre version
    qui elle est sous la forme d'une \textbf{documentation} à destination d'un
    lecteur.

    Cette approche est particulièrement intéressante pour expliquer des
    programmes Coq car elle permet de changer l'ordre logique des différents
    éléments du programme pour ainsi avoir une version plus facile à comprendre
    pour des humains : la preuve de théorèmes mathématiques en Coq peut ainsi
    être plus facile à comprendre pour un lecteur, et à partir du programme
    fournissant la preuve, il est possible d'obtenir un article scientifique
    expliquant cette preuve.

    \subsubsection{Fonctionnement de Coq-tex}
    Coq-tex est un outil se rapprochant de ce concept de programmation lettrée.
    Le programme prend en argument un fichier LaTex, et extrait les phrases
    Coq contenues dans celui-ci, pour y insérer à la place le résultat de
    leur interprétation.

    La production d'un document LaTeX bénéficie ainsi d'une phase
    d'interprétation du code Coq contenu dans ce document, pour pouvoir fournir
    le résultat de l'interprétation de code avec une version récente de
    l'interprète Coq. Cet outil est notamment utilisé pour générer la documentation
    officielle du projet Coq.

    Le fonctionnement de Coq-Tex gravite autour de 3 environnements \footnote{Un
    environnement en LaTeX est une portion de code entourée des balises
    \texttt{$\backslash$begin\{environnement\}} et
    \texttt{$\backslash$end\{environnement\}}, où \texttt{environnement} est
    le nom de l'environnement. Le texte contenu dans ces balises sera ainsi
    traité selon le type d'environnement dans lequel il est inclut.}
    insérés
    dans un fichier LaTeX. La liste suivante détaille le comportement de
    chacun :
    \begin{itemize}
      \item \texttt{coq\_example} : \\
        Le code contenu dans ces balises sera extrait et évalué par
        l'interprète phrase par phrase. Chacune de ces phrases sera copiée
        dans le fichier de sortie, et sera suivie du résultat de son
        interprétation.
      \item \texttt{coq\_example*} : \\
        Le code contenu dans ces balises sera extrait et interprété, et il
        sera recopié dans le fichier de sortie. Cependant, les réponses de
        l'interprète seront ignorées;.
      \item \texttt{coq\_eval} : \\
        Les phrases contenues dans l'environnement \texttt{coq\_eval} seront
        évaluées silencieusement. Seulement le résultat de leur évaluation sera
        inclut dans le document de sortie.
    \end{itemize}

    \subsubsection{Facilité de fusion avec Coqdoc}
    Coq-tex reprend la même idée que Coqdoc dans le sens où ces deux outils
    ont un rôle de traduction : ils prennent un document d'entrée pour effectuer
    une évaluation de certaines portions du code contenues dans celui-ci, et
    générer un document mis en forme.

    Ainsi ces deux outils ont des rôles de documentation du code source, et
    partagent d'importantes similarités dans leur fonctionnement. Une fusion
    de ces deux outils apparaît donc comme logique puisqu'elle facilitera
    ainsi la maintenance de l'outil, et regroupera des sections logique qui
    auparavant étaient dupliquées dans deux programmes.

    Intégrer cet outil dans Coqdoc permet également d'enrichir Coq-tex, en
    permettant à l'utilisateur de profiter de la diversité des formats de
    sortie de Coqdoc et en rajoutant les caractéristique de l'outil Coq.

    \subsection{But général}
    %% Detaillers caveats
    %% Detail de l'architecture souhaitée
    \subsection{Présentation des outils utilisés}
    %% Ocaml
    %% Interaction avec coqtop
    \subsection{Nouveaux éléments du logiciel}
    %% Introduire l'interaction avec le toplevel dans les assistants de preuves
    %% Rm .glob
    \subsubsection{Interaction avec l'interprète}
    %% Parler de CoqIDE

    \subsection{Résumé des objectifs}
    Nous rappelons brièvement les objectifs introduit dans cette section
    concernant le logiciel produit pendant ce stage :
    \begin{itemize}
      \item Le nouveau Coqdoc doit avoir un comportement le plus proche
        possible de l'ancien Coqdoc.
      \item Il doit également remplacer Coq-tex, l'outil de programmation
        lettrée.
      \item L'attention doit être portée sur une architecture extensible, qui
        permette aux développeurs de rajouter de nouveaux comportements
        et d'enrichir le logiciel.
    \end{itemize}



  \section{Compte-rendu d'activité}
  %% Pour mettre en avant l'extensiblité du logiciel, parler du développement
  %% de coq-tex : on rajoute un module d'entree, 3 nouvelles requetes, et le tour est joue !
    \subsection{Conception de l'architecture du logiciel}
    \subsection{Choix techniques de la conception}
    \subsection{Déroulement du développement logiciel}
    \subsection{Résultats du stage}
  \section{Interprétation et critique des résultats}
    \subsection{Version préliminaire de Coqdoc stable}
    \subsection{Extensibilité du logiciel}
    \subsection{Finalisation de Coqdoc}
    \subsection{Perspectives d'évolution du logiciel}
    \subsubsection{Protocole d'interaction}
    \subsubsection{Enrichissement de Coqdoc}
\chapter{Conclusion générale}
%% 2
\input{annexes.tex}
\end{document}

